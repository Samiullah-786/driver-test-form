const fullQuizData = [
  {
    question: "<img src='Q1/1.png' width='100%'> Tick the sign of “No entry” ",
    options: [
      "Q1/2.png",
      "Q1/3.png",
      "Q1/4.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q1/5.png' width='100%'> Tick the sign of “Road is closed ahead” ",
    options: [
      "Q1/6.png",
      "Q1/7.png",
      "Q1/8.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q1/9.png' width='100%'> Tick the sign of “No entry for vehicles exceeding width more than 8’-6” ",
    options: [
      "Q1/10.png",
      "Q1/11.png",
      "Q1/12.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q1/13.png' width='100%'> Tick the sign of “Slow down” ",
    options: [
      "Q1/14.png",
      "Q1/15.png",
      "Q1/16.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q1/17.png' width='100%'> Tick the sign of “Stop for Police check post” ",
    options: [
      "Q1/18.png",
      "Q1/19.png",
      "Q1/20.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q1/21.png' width='100%'> Tick the sign of “End of all prohibitions imposed” ",
    options: [
      "Q1/22.png",
      "Q1/23.png",
      "Q1/24.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q1/25.png' width='100%'> Tick the sign of “Minor cross road from left” ",
    options: [
      "Q1/26.png",
      "Q1/27.png",
      "Q1/28.png"
    ],
    correctAnswerIndex: 2
  },
  {
    question: "<img src='Q1/29.png' width='100%'> Tick the sign of “Left side road is closed” ",
    options: [
      "Q1/30.png",
      "Q1/31.png",
      "Q1/32.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q1/33.png' width='100%'> Tick the sign of “Turn right” ",
    options: [
      "Q1/34.png",
      "Q1/35.png",
      "Q1/36.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q1/37.png' width='100%'> Tick the sign of “Box roundabout” ",
    options: [
      "Q1/38.png",
      "Q1/39.png",
      "Q1/40.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q2/1.png' width='100%'> Tick the sign of “Major cross road” ",
    options: [
      "Q2/2.png",
      "Q2/3.png",
      "Q2/4.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q2/5.png' width='100%'> Tick the sign of “Two way traffic” ",
    options: [
      "Q2/6.png",
      "Q2/7.png",
      "Q2/8.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q2/9.png' width='100%'> Tick the sign of “other dangers” ",
    options: [
      "Q2/10.png",
      "Q2/11.png",
      "Q2/12.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q2/13.png' width='100%'> Tick the sign of “Compulsory roundabout” ",
    options: [
      "Q2/14.png",
      "Q2/15.png",
      "Q2/16.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q2/17.png' width='100%'> Tick the sign of “No entry for vehicles” ",
    options: [
      "Q2/18.png",
      "Q2/19.png",
      "Q2/20.png"
    ],
    correctAnswerIndex: 2
  },
  {
    question: "<img src='Q2/21.png' width='100%'> Tick the sign of “Goods vehicle prohibited” ",
    options: [
      "Q2/22.png",
      "Q2/23.png",
      "Q2/24.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q2/25.png' width='100%'> Tick the sign of “Honking horn prohibited” ",
    options: [
      "Q2/26.png",
      "Q2/27.png",
      "Q2/28.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q2/29.png' width='100%'> Tick the sign of “Speed limit 50 KM” ",
    options: [
      "Q2/30.png",
      "Q2/31.png",
      "Q2/32.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q2/33.png' width='100%'> Tick the sign of “End of prohibition of overtaking” ",
    options: [
      "Q2/34.png",
      "Q2/35.png",
      "Q2/36.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q2/37.png' width='100%'> Tick the sign of “overtaking prohibited” ",
    options: [
      "Q2/38.png",
      "Q2/39.png",
      "Q2/40.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q3/1.png' width='100%'> Tick the sign of “Slippery road” ",
    options: [
      "Q3/2.png",
      "Q3/3.png",
      "Q3/4.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q3/5.png' width='100%'> Tick the sign of “Roundabout” ",
    options: [
      "Q3/6.png",
      "Q3/7.png",
      "Q3/8.png"
    ],
    correctAnswerIndex: 2
  },
  {
    question: "<img src='Q3/9.png' width='100%'> Tick the sign of “Uneven road” ",
    options: [
      "Q3/10.png",
      "Q3/11.png",
      "Q3/12.png"
    ],
    correctAnswerIndex: 2
  },
  {
    question: "<img src='Q3/13.png' width='100%'> Tick the sign of “Keep to the left” ",
    options: [
      "Q3/14.png",
      "Q3/15.png",
      "Q3/16.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q3/17.png' width='100%'> Tick the sign of “Dual carriageway end” ",
    options: [
      "Q3/18.png",
      "Q3/19.png",
      "Q3/20.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q3/21.png' width='100%'> Tick the sign of “STOP” ",
    options: [
      "Q3/22.png",
      "Q3/23.png",
      "Q3/24.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q3/25.png' width='100%'> Tick the sign of “Minor cross road from right” ",
    options: [
      "Q3/26.png",
      "Q3/27.png",
      "Q3/28.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q3/29.png' width='100%'> Tick the sign of “Traffic signal roundabout” ",
    options: [
      "Q3/30.png",
      "Q3/31.png",
      "Q3/32.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q3/33.png' width='100%'> Tick the sign of “Restaurant” ",
    options: [
      "Q3/34.png",
      "Q3/35.png",
      "Q3/36.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q3/37.png' width='100%'> Tick the sign of “Lane is closed” ",
    options: [
      "Q3/38.png",
      "Q3/39.png",
      "Q3/40.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q4/1.png' width='100%'> Tick the sign of “Go straight or left” ",
    options: [
      "Q4/2.png",
      "Q4/3.png",
      "Q4/4.png"
    ],
    correctAnswerIndex: 2
  },
  {
    question: "<img src='Q4/5.png' width='100%'> Tick the sign of “U Turn is prohibited” ",
    options: [
      "Q4/6.png",
      "Q4/7.png",
      "Q4/8.png"
    ],
    correctAnswerIndex: 2
  },
  {
    question: "<img src='Q4/9.png' width='100%'> Tick the sign of “Turn right” ",
    options: [
      "Q4/10.png",
      "Q4/11.png",
      "Q4/12.png"
    ],
    correctAnswerIndex: 2
  },
  {
    question: "<img src='Q4/13.png' width='100%'> Tick the sign of “Dangerous descent” ",
    options: [
      "Q4/14.png",
      "Q4/15.png",
      "Q4/16.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q4/17.png' width='100%'> Tick the sign of “Double bend to the left” ",
    options: [
      "Q4/18.png",
      "Q4/19.png",
      "Q4/20.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q4/21.png' width='100%'> Tick the sign of “Road narrows on both sides” ",
    options: [
      "Q4/22.png",
      "Q4/23.png",
      "Q4/24.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q4/25.png' width='100%'> Tick the sign of “Left bend” ",
    options: [
      "Q4/26.png",
      "Q4/27.png",
      "Q4/28.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q4/29.png' width='100%'> Tick the sign of “Parking this way” ",
    options: [
      "Q4/30.png",
      "Q4/31.png",
      "Q4/32.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q4/33.png' width='100%'> Tick the sign of “Overtaking prohibited on central line” ",
    options: [
      "Q4/34.png",
      "Q4/35.png",
      "Q4/36.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q4/37.png' width='100%'> Tick the sign of “Warning sign” ",
    options: [
      "Q4/38.png",
      "Q4/39.png",
      "Q4/40.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q5/1.png' width='100%'> Tick the sign of “Yield to the traffic approaching from the right on any leg of the intersection” ",
    options: [
      "Q5/2.png",
      "Q5/3.png",
      "Q5/4.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q5/5.png' width='100%'> Tick the sign of “Cattle crossing” ",
    options: [
      "Q5/6.png",
      "Q5/7.png",
      "Q5/8.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q5/9.png' width='100%'> Tick the sign of “Pedestrians prohibited” ",
    options: [
      "Q5/10.png",
      "Q5/11.png",
      "Q5/12.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q5/14.png' width='100%'> Tick the sign of “Turn to the left” ",
    options: [
      "Q5/13.png",
      "Q5/15.png",
      "Q5/16.png"
    ],
    correctAnswerIndex: 2
  },
  {
    question: "<img src='Q5/17.png' width='100%'> Tick the sign of “Children crossing” ",
    options: [
      "Q5/18.png",
      "Q5/19.png",
      "Q5/20.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q5/21.png' width='100%'> Tick the sign of “Falling rock” ",
    options: [
      "Q5/22.png",
      "Q5/23.png",
      "Q5/24.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q5/25.png' width='100%'> Tick the sign of “Road dips” ",
    options: [
      "Q5/26.png",
      "Q5/27.png",
      "Q5/28.png"
    ],
    correctAnswerIndex: 0
  },
  {
    question: "<img src='Q5/29.png' width='100%'> Tick the sign of “Minor cross roads from right and left respectively” ",
    options: [
      "Q5/30.png",
      "Q5/31.png",
      "Q5/32.png"
    ],
    correctAnswerIndex: 2
  },
  {
    question: "<img src='Q5/33.png' width='100%'> Tick the sign of “Level crossing (without gate)” ",
    options: [
      "Q5/34.png",
      "Q5/35.png",
      "Q5/36.png"
    ],
    correctAnswerIndex: 1
  },
  {
    question: "<img src='Q5/37.png' width='100%'> Tick the sign of “Slow down to stop” ",
    options: [
      "Q5/38.png",
      "Q5/39.png",
      "Q5/40.png"
    ],
    correctAnswerIndex: 2
  }
];

const quizData = fullQuizData.sort(() => 0.5 - Math.random()).slice(0, 10);

let currentQuestionIndex = 0;
let score = 0;
let detailedResults = [];
let driverData = {};

const questionEl = document.getElementById("question");
const optionsEl = document.getElementById("options");
const nextButton = document.getElementById("nextBtn");
const resultEl = document.getElementById("result");
const driverForm = document.getElementById("driver-details-form");
const startButton = document.getElementById("startBtn");
const downloadButton = document.getElementById("downloadBtn");
const themeToggleButton = document.getElementById("theme-toggle-btn");

// Theme toggle functionality
themeToggleButton.addEventListener("click", () => {
  document.body.classList.toggle("dark-mode");
  if (document.body.classList.contains("dark-mode")) {
    themeToggleButton.textContent = '☀️';
  } else {
    themeToggleButton.textContent = '💡';
  }
});

startButton.addEventListener("click", () => {
  const driverName = document.getElementById("driverName").value;
  const phoneNumber = document.getElementById("phoneNumber").value;
  const cnicNumber = document.getElementById("cnicNumber").value;
  const licenseType = document.getElementById("licenseType").value;

  if (driverName && phoneNumber && cnicNumber) {
    driverData = {
      name: driverName,
      phone: phoneNumber,
      cnic: cnicNumber,
      license: licenseType
    };
    driverForm.classList.add("hidden");
    questionEl.classList.remove("hidden");
    optionsEl.classList.remove("hidden");
    loadQuestion();
  } else {
    alert("Please fill out all the details to start the test.");
  }
});

downloadButton.addEventListener("click", downloadExcel);

function loadQuestion() {
  const current = quizData[currentQuestionIndex];
  // Correctly set the inner HTML to render the image
  questionEl.innerHTML = (currentQuestionIndex + 1) + ". " + current.question;
  optionsEl.innerHTML = "";

  current.options.forEach((opt, index) => {
    const img = document.createElement("img");
    img.src = opt;
    img.classList.add("option-img");
    img.onclick = () => checkAnswer(index, img);
    optionsEl.appendChild(img);
  });

  nextButton.classList.add("hidden");
}

function checkAnswer(selectedIndex, imgElement) {
  const current = quizData[currentQuestionIndex];
  const isCorrect = selectedIndex === current.correctAnswerIndex;
  const allOptions = document.querySelectorAll(".option-img");

  allOptions.forEach(opt => opt.onclick = null);

  if (isCorrect) {
    imgElement.classList.add("correct");
    score++;
  } else {
    imgElement.classList.add("incorrect");
  }

  detailedResults.push({
    questionNumber: currentQuestionIndex + 1,
    question: current.question.split(" ").slice(1).join(" "),
    selectedOption: current.options[selectedIndex],
    correctOption: current.options[current.correctAnswerIndex],
    isCorrect: isCorrect
  });

  nextButton.classList.remove("hidden");
}

nextButton.addEventListener("click", () => {
  currentQuestionIndex++;
  if (currentQuestionIndex < quizData.length) {
    loadQuestion();
  } else {
    showResults();
  }
});

function showResults() {
  questionEl.classList.add("hidden");
  optionsEl.classList.add("hidden");
  nextButton.classList.add("hidden");

  let resultHTML = `<h2>Your Score: ${score}/${quizData.length}</h2>`;
  resultHTML += `
            <table>
                <tr>
                    <th>Q#</th>
                    <th>Question</th>
                    <th>Your Answer</th>
                    <th>Correct Answer</th>
                    <th>Result</th>
                </tr>
        `;

  detailedResults.forEach(r => {
    resultHTML += `
                <tr>
                    <td>${r.questionNumber}</td>
                    <td>${r.question}</td>
                    <td><img src="${r.selectedOption}" width="50"></td>
                    <td><img src="${r.correctOption}" width="50"></td>
                    <td class="${r.isCorrect ? "correct-text" : "incorrect-text"}">
                        ${r.isCorrect ? "Correct" : "Wrong"}
                    </td>
                </tr>
            `;
  });

  resultHTML += `</table>`;
  resultEl.innerHTML = resultHTML;
  downloadButton.classList.remove("hidden");
}

function downloadExcel() {
  const data = [
    ["Driver Details"],
    ["Name", driverData.name],
    ["Phone Number", driverData.phone],
    ["CNIC Number", driverData.cnic],
    ["License Type", driverData.license],
    [],
    ["Quiz Results"],
    ["Q#", "Question", "Your Answer", "Correct Answer", "Result"],
  ];

  detailedResults.forEach(r => {
    const resultText = r.isCorrect ? "Correct" : "Wrong";
    data.push([r.questionNumber, r.question, r.selectedOption, r.correctOption, resultText]);
  });

  const ws = XLSX.utils.aoa_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Quiz Results");
  XLSX.writeFile(wb, "driver_test_results.xlsx");
}

// Initial state: show form, hide quiz elements
document.getElementById("question").classList.add("hidden");

document.getElementById("options").classList.add("hidden");
